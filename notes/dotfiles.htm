<!DOCTYPE html>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
	<meta name="theme-color" content="#E2FAF9">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="google-site-verification" content="Yn_X0a7RyXs1GuMzbXL2g3P-tH1A29W_6yyG6M8oBnk">
	<link rel="shortcut icon" type="image/x-icon" href="/static/sky.ico">
	<link rel="stylesheet" type="text/css" href="/static/style.css">
	<script src="/static/script.js"></script>
	<title>Selected documentation and usage notes for my dotfiles | sentimental ¬µsounds</title>
</head>
<body>
<audio hidden id="bgm"></audio>
<div class="navbar">
	<a href="/index.htm"><img class="avatar" alt="avatar" src="/static/avatar.png"></a>
	<div class="container">
		<div class="title"><a href="/index.htm">sentimental ¬µsounds</a></div>
		<div class="subtitle">the echoes of time stand still</div>
		<ul>
			<li><a id="bgm_toggle" href="javascript:play()">‚ô´ play</a></li>
			<li><a href="https://github.com/microsounds">my github</a></li>
			<li><a href="/notes/dotfiles.htm">my dotfiles</a></li>
			<li><a href="/notes/index.htm">my notes</a></li>
		</ul>
	</div>
</div>
<div class="content">
<!--kagami v0.5.3 ‚Äî static microblog processor-->
<h1>Selected documentation and usage notes for my dotfiles<span id="Selected-documentation-and-usage-notes-for-my-dotfiles"></span></h1>
<p><strong>Revision No. 743, commit <code>5d3ff7d</code>.</strong></p>
<p><strong>‚Äúsxhkd: Rewrote some commands, colorized syslog, nmtui‚Äù</strong></p>
<p><div class="toc"><p>Table of Contents</p><ul><li><a href="#Selected-documentation-and-usage-notes-for-my-dotfiles">Selected documentation and usage notes for my dotfiles</a></li><li><a href="#_dotfilesatelier_shimeji"><em>dotfiles‚Äî‚Äúatelier‚Äù</em>![shimeji]</a></li><li><a href="#Quick-start">Quick start</a><ul><li><a href="#Quick-start-on-Termux-for-Android">Quick start on Termux for Android</a></li><li><a href="#Notes-on-platform-support">Notes on platform support</a></li></ul></li><li><a href="#Usage-notes">Usage notes</a><ul><li><a href="#Using-git-meta">Using <code>git meta</code></a></li><li><a href="#Using-.once.d-post-install-scripts">Using <code>~/.once.d</code> post-install scripts</a><ul><li><a href="#Essential-and-optional-package-groups">Essential and *optional package groups</a></li><li><a href="#Essential-and-persistent-upstream-utilities">Essential and *persistent upstream utilities</a></li></ul></li><li><a href="#Window-manager">Window manager</a><ul><li><a href="#Reduced-layout-for-Chromebooks">Reduced layout for Chromebooks</a></li></ul></li></ul></li><li><a href="#Some-environment-notes">Some environment notes</a><ul><li><a href="#X-server-invocation">X server invocation</a></li><li><a href="#Optional-X-Window-configuration">Optional X Window configuration</a><ul><li><a href="#.xrandr"><code>~/.xrandr</code></a></li><li><a href="#.xdecor"><code>~/.xdecor</code></a></li></ul></li><li><a href="#X-resources-and-theming">X resources and theming</a><ul><li><a href="#List-of-available-macros">List of available macros</a></li></ul></li></ul></li><li><a href="#Non-standard-commands">Non-standard commands</a><ul><li><a href="#cd"><code>cd</code></a></li><li><a href="#chromium"><code>chromium</code></a><ul><li><a href="#Managed-policy-overrides">Managed policy overrides</a></li></ul></li><li><a href="#git"><code>git</code></a></li><li><a href="#nano"><code>nano</code></a></li><li><a href="#notify-send"><code>notify-send</code></a></li><li><a href="#sc-spreadsheet-calculator"><code>sc</code> (spreadsheet calculator)</a><ul><li><a href="#sc-pre-run-macro-example"><code>sc</code> pre-run macro example</a></li></ul></li></ul></li><li><a href="#Complete-source-listing">Complete source listing</a></li></ul></div></p>
<p>The verbosity factor of this document compared to comment lines of code
in this repo is about <strong>5:1</strong>.</p>
<p>If this document is <em>18KiB</em> in size, and the
approximate size of all comment lines of code is <em>54KiB</em>,
then this document currently covers about
<b style="font-size: 20px;">6.99%</b> of all implemented features
and behavior in this repository.
This is just an <a href="https://raw.githubusercontent.com/microsounds/microsounds.github.io/master/.scripts/dotfiles-ls.sh">automated guess</a> though.</p>
<p>This document and repository is also mirrored at
<a href="https://github.com/microsounds/atelier"><code>microsounds/atelier</code></a> on GitHub.</p>
<p>Last updated üåë&#xFE0E; Fri, Dec 17th, 2021.</p>
<h1><div align="center"><em>dotfiles‚Äî‚Äúatelier‚Äù</em><img src="/" alt="shimeji" /></div><span id="_dotfilesatelier_shimeji"></span></h1>
<div align="center">
    <img src="https://img.shields.io/github/commit-activity/m/microsounds/atelier?logo=github">
    <img src="https://img.shields.io/github/repo-size/microsounds/atelier?logo=github">
    <a href="https://github.com/microsounds/atelier/actions/workflows/ci.yml"><img src="https://github.com/microsounds/atelier/actions/workflows/ci.yml/badge.svg"></a>
    <br>
    <a href="https://debian.org/distrib/"><img src="https://img.shields.io/badge/Debian-bullseye-%23c70036.svg?logo=debian"></a>
    <a href="https://dwm.suckless.org/"><img src="https://img.shields.io/badge/suckless-dwm-%23224488?logo=suckless"></a>
    <a href="https://nano-editor.org/"><img src="https://shields.io/badge/Editor-GNU%20nano-%23440077?logo=windows-terminal"></a>
    <a href="https://www.youtube.com/watch?v=UL8IpdFGeHU"><img src="https://img.shields.io/badge/theme-night drive-%2363B0B0?logo=github-sponsors"></a>
    <br>
    <a href="http://canarypop.ciao.jp/shimehatsune.htm"><sup><i>shimeji miku &copy; 2010 canary yellow</i></sup></a>
</div>
<p>This is my primary computing setup, a self-contained graphical shell environment for Debian GNU/Linux.</p>
<ul>
<li>Git is used to maintain an identical and reproducible setup across multiple machines.</li>
<li>A series of post-install scripts in <a href="https://github.com/microsounds/atelier/blob/master/.once.d"><code>~/.once.d</code></a> document and reproduce system-wide deviations from a fresh install.
<ul>
<li><em>A <a href="https://github.com/microsounds/atelier/blob/master/.github/workflows/ci.yml">suite of unit tests</a> ensures a reproducible installation with each revision.</em></li>
</ul>
</li>
</ul>
<p>Basic installation instructions are provided, along with some documentation for the most essential components.</p>
<p><a href="https://github.com/microsounds/microsounds/raw/master/dotfiles/scrot.png"><img src="https://github.com/microsounds/microsounds/raw/master/dotfiles/scrot.png" alt="scrot" /></a></p>
<blockquote>
<p><strong>PICTURED</strong><br>
<em>Debian stable, a ‚Äúgraphical shell‚Äù environment consisting mostly of xorg, dwm, sxhkd and various urxvt clients.</em></p>
</blockquote>
<h1>Quick start<span id="Quick-start"></span></h1>
<ol>
<li>Install Debian stable, perform a base install with no DE selected and no standard utilities when prompted.
<ul>
<li><em>Do not perform these steps on <code>tty1</code>, <code>xinit</code> will launch without <code>dwm</code> present and you will be kicked.</em></li>
</ul>
</li>
<li>Install <code>git</code>, <code>wget</code>, and <code>sudo</code>, then add yourself to the <code>sudo</code> group.
<ul>
<li>Log back in to apply changes to group membership.</li>
</ul>
</li>
<li>Bootstrap the system automatically with a hard git reset from this repo, this is done only once.
<pre><code class="language-shell">$ git clone --bare https://github.com/microsounds/atelier ~/.config/meta
$ git --git-dir=$HOME/.config/meta --work-tree=$HOME reset --hard
&gt;&gt; Invoke the login shell to apply changes made to the environment
$ exec $SHELL -l
</code></pre>
</li>
<li>Run <code>post-install</code> in the shell to run post-install scripts automatically.
<ul>
<li><em>Sets up the package manager, installs essential packages, compiles window manager, text editor, etc.</em></li>
</ul>
</li>
<li>Reboot to finish.
<ul>
<li><em><a href="https://github.com/microsounds/atelier/blob/master/.xinitrc"><code>xinit</code></a> starts automatically upon login to <a href=".profile"><code>tty1</code></a>.</em></li>
</ul>
</li>
</ol>
<a href="https://github.com/microsounds/microsounds/raw/master/dotfiles/mobile-scrot.jpg">
    <img width="125px" align="right" src="https://github.com/microsounds/microsounds/raw/master/dotfiles/mobile-scrot2.png">
</a>
<h2>Quick start on Termux for Android<span id="Quick-start-on-Termux-for-Android"></span></h2>
<blockquote>
<p><strong>NOTE</strong><br>
<em>Currently, only a basic shell environment in single-user mode is supported.<br>
This is meant to be a lightweight port with modifications, do not initiate a full <code>post-install</code>.</em></p>
</blockquote>
<ol>
<li>Install <code>git</code>, and bootstrap the system using <code>git reset --hard</code> as described above.</li>
<li>Post-install: Run only <a href="https://github.com/microsounds/atelier/blob/master/.once.d/a0-android-termux.sh"><code>~/.once.d/a0-android-termux.sh</code></a>
<ul>
<li>Applies android-specific hacks and termux specific dotfiles for theming and softkeys.</li>
</ul>
</li>
<li>When pulling changes from upstream, always stash changes to prevent merge conflicts.</li>
</ol>
<h2>Notes on platform support<span id="Notes-on-platform-support"></span></h2>
<p><strong>Full graphical shell environment</strong></p>
<ul>
<li>Any conventional BIOS/UEFI-compliant x86-based Personal Computer</li>
<li>x86-based Chromebooks in Developer Mode (SeaBIOS), or liberated with UEFI firmware (Coreboot).
<ul>
<li><em>See <a href="https://mrchromebox.tech/">https://mrchromebox.tech/</a> for more information on unlocking your bootloader.</em></li>
</ul>
</li>
<li><a href="http://chip.jfpossibilities.com/docs/pocketchip.html">Next Thing Co. PocketC.H.I.P</a> armhf-based portable <del>toy computer</del> linux handheld
<ul>
<li><em>Final NTC-provided Debian 8 (jessie) OS images from 2016 come with out-of-tree <code>4.4.13-ntc-mlc</code> kernel pinned, upgradeable to 10 (buster).</em></li>
</ul>
</li>
</ul>
<p><strong>Single-user minimal shell environment</strong></p>
<ul>
<li>Bootstrapping in virtualized container instances for use in CI/CD workflows</li>
<li>Termux terminal emulator and Linux environment for Android
<ul>
<li><em>Non-standard *NIX environment, currently only supports a subset of available features.</em></li>
</ul>
</li>
</ul>
<h1>Usage notes<span id="Usage-notes"></span></h1>
<h2>Using <code>git meta</code><span id="Using-git-meta"></span></h2>
<p>For local-scope changes, files in <code>$HOME</code> are versioned and mangled in place using Git.</p>
<ul>
<li><code>$HOME</code> is considered the detached working tree for a git <strong>bare repo</strong> located at <code>~/.config/meta</code></li>
<li>The <code>meta</code> alias prefixes all git commands with <code>--git-dir=$HOME/.config/meta --work-tree=$HOME</code></li>
<li><code>meta status</code> will ignore files not manually added or tracked by this git repo.
<ul>
<li><em>This is achieved using the <code>status.showUntrackedFiles</code> option and not via manually updating <code>~/.gitignore</code> as is commonly done.</em></li>
</ul>
</li>
<li>Invoking <code>git</code> outside of a valid git directory will append the <code>meta</code> alias automatically.
<ul>
<li><em><code>init</code> and <code>clone</code> commands are unaffected.</em></li>
</ul>
</li>
</ul>
<h2>Using <code>~/.once.d</code> post-install scripts<span id="Using-.once.d-post-install-scripts"></span></h2>
<p>All system-wide changes are performed through automated scripts located in <a href="https://github.com/microsounds/atelier/blob/master/.once.d"><code>~/.once.d</code></a>, you can run them all at once with shell function <code>post-install</code>.
Each script is self-contained, you can run them individually, anytime.</p>
<ul>
<li>Some scripts only apply to specific hardware configurations, and will exit even if they are run.</li>
<li>Scripts affecting <code>systemd</code> or the bootloader will be skipped in virtualized container contexts.</li>
<li>Locally installed software is installed to <a href="https://github.com/microsounds/atelier/blob/master/.local/bin"><code>~/.local/bin</code></a> when possible.</li>
</ul>
<table>
<thead>
<tr>
<th>series</th>
<th>function</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>0*</code></td>
<td>System-wide changes performed through the package manager.</td>
</tr>
<tr>
<td><code>1*</code></td>
<td>Changes to <a href="https://github.com/microsounds/atelier/blob/master/.local"><code>~/.local</code></a> file hierarchy, such as locally installed software and resources.</td>
</tr>
<tr>
<td><code>2*</code></td>
<td>System-wide changes that bypass the package manager, such as changes to <code>/etc</code>.<br><em>These are hacks.</em></td>
</tr>
<tr>
<td><code>c*</code></td>
<td>System-wide changes affecting chromebook hardware only.</td>
</tr>
<tr>
<td><code>a*</code></td>
<td>Android-specific hacks only.</td>
</tr>
<tr>
<td><code>p*</code></td>
<td>NTC PocketCHIP-specific hacks only.</td>
</tr>
</tbody>
</table>
<h3>Essential and *optional package groups<span id="Essential-and-optional-package-groups"></span></h3>
<ul>
<li><a href="https://github.com/microsounds/atelier/blob/master/.comforts"> <code>~/.comforts</code> </a> describes a list of non-optional package groups that will be installed through the package manager.
<ul>
<li><em>Optional package groups are marked with an *asterisk, you will be prompted to approve these at runtime.</em></li>
</ul>
</li>
</ul>
<h3>Essential and *persistent upstream utilities<span id="Essential-and-persistent-upstream-utilities"></span></h3>
<ul>
<li><a href="https://github.com/microsounds/atelier/blob/master/.comforts-git"><code>~/.comforts-git</code></a> describes the full list of utilities compiled and installed from their upstream git sources.
<ul>
<li><em>Repos must have a typical <code>./configure</code> and/or <code>make install PREFIX=...</code> metaphor to build correctly.</em></li>
<li><em>Sources marked with an *asterisk will be persistently installed to <code>~/.config/${URL##*/}</code></em></li>
</ul>
</li>
</ul>
<p>Installation can be customized with user-provided executable install <del>hacks</del> scripts, named <code>{pre,post}-run</code>.
These can be placed in <a href="https://github.com/microsounds/atelier/blob/master/.config/upstream"><code>~/.config/upstream</code></a> or at the root of a persistently installed utility‚Äôs install directory as described above</p>
<p>Rationale for doing things this way is summarized in commit <a href="https://github.com/microsounds/atelier/commit/2fe1c3745"><code>2fe1c3745</code></a>.</p>
<h2>Window manager<span id="Window-manager"></span></h2>
<p><code>dwm</code> keybinds are the <a href="https://ratfactor.com/dwm">defaults</a> with several exceptions.
Primary modkey <code>Mod1</code> is super instead of alt.</p>
<table>
<thead>
<tr>
<th align="right">shift +</th>
<th align="right">alt +</th>
<th align="left">key</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right"></td>
<td align="right">kill window</td>
<td align="left">F4</td>
</tr>
<tr>
<td align="right">counter-clockwise</td>
<td align="right">switch focused window</td>
<td align="left">tab</td>
</tr>
<tr>
<td align="right"><strong>shift +</strong></td>
<td align="right"><strong>super +</strong></td>
<td align="left"><strong>key</strong></td>
</tr>
<tr>
<td align="right">float window<sup>[toggle]</sup></td>
<td align="right">monocle window<sup>[toggle]</sup></td>
<td align="left">space</td>
</tr>
<tr>
<td align="right">set as master window<sup>[toggle]</sup></td>
<td align="right">terminal</td>
<td align="left">return</td>
</tr>
<tr>
<td align="right"></td>
<td align="right">launcher</td>
<td align="left">p</td>
</tr>
<tr>
<td align="right"></td>
<td align="right">file manager</td>
<td align="left">e</td>
</tr>
<tr>
<td align="right"></td>
<td align="right">ssh-add<sup>[toggle]</sup></td>
<td align="left">backspace</td>
</tr>
<tr>
<td align="right">partial screenshot</td>
<td align="right">screenshot</td>
<td align="left">print</td>
</tr>
<tr>
<td align="right"></td>
<td align="right"><em>reserved</em></td>
<td align="left">scroll lock</td>
</tr>
<tr>
<td align="right"></td>
<td align="right"><em>reserved</em></td>
<td align="left">pause</td>
</tr>
<tr>
<td align="right">reboot</td>
<td align="right">shutdown</td>
<td align="left">F1</td>
</tr>
<tr>
<td align="right">hibernate</td>
<td align="right">sleep</td>
<td align="left">F2</td>
</tr>
<tr>
<td align="right">hibernate + reboot</td>
<td align="right">display off</td>
<td align="left">F3</td>
</tr>
<tr>
<td align="right">configure networking</td>
<td align="right">calculator</td>
<td align="left">F4</td>
</tr>
<tr>
<td align="right">configure displays</td>
<td align="right">switch active display<sup>[toggle]</sup></td>
<td align="left">F5</td>
</tr>
<tr>
<td align="right">minimum brightness</td>
<td align="right">lower brightness 10%</td>
<td align="left">F6</td>
</tr>
<tr>
<td align="right">maximum brightness</td>
<td align="right">raise brightness 10%</td>
<td align="left">F7</td>
</tr>
<tr>
<td align="right">configure audio</td>
<td align="right">mute<sup>[toggle]</sup></td>
<td align="left">F8</td>
</tr>
<tr>
<td align="right"></td>
<td align="right">lower volume 5%</td>
<td align="left">F9</td>
</tr>
<tr>
<td align="right"></td>
<td align="right">raise volume 5%</td>
<td align="left">F10</td>
</tr>
<tr>
<td align="right"></td>
<td align="right">randomize wallpaper</td>
<td align="left">F11</td>
</tr>
<tr>
<td align="right"></td>
<td align="right"><em>reserved</em></td>
<td align="left">F12</td>
</tr>
<tr>
<td align="right"></td>
<td align="right"><strong>ctrl + alt +</strong></td>
<td align="left"><strong>key</strong><sup>[special]</sup></td>
</tr>
<tr>
<td align="right"></td>
<td align="right">task manager</td>
<td align="left">delete</td>
</tr>
<tr>
<td align="right"></td>
<td align="right">syslog</td>
<td align="left">insert</td>
</tr>
</tbody>
</table>
<h3>Reduced layout for Chromebooks<span id="Reduced-layout-for-Chromebooks"></span></h3>
<p>Search/Everything/Caps lock key serves as the super key. Same as above, with the following changes:</p>
<table>
<thead>
<tr>
<th align="right">alt gr +</th>
<th align="left">key</th>
<th align="left">remarks</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">prior</td>
<td align="left">up</td>
<td align="left"></td>
</tr>
<tr>
<td align="right">next</td>
<td align="left">down</td>
<td align="left"></td>
</tr>
<tr>
<td align="right">home</td>
<td align="left">left</td>
<td align="left"></td>
</tr>
<tr>
<td align="right">end</td>
<td align="left">right</td>
<td align="left"></td>
</tr>
<tr>
<td align="right">delete</td>
<td align="left">backspace</td>
<td align="left"></td>
</tr>
<tr>
<td align="right">F11</td>
<td align="left">delete</td>
<td align="left">same as power key, keystroke repeat not available</td>
</tr>
</tbody>
</table>
<h1>Some environment notes<span id="Some-environment-notes"></span></h1>
<h2>X server invocation<span id="X-server-invocation"></span></h2>
<p>No display manager is used, login to <code>tty1</code> to start the graphical shell.</p>
<p>All daemons and services required to support the graphical shell are initialized along with the X server and are terminated when the user terminates the session.</p>
<p><code>systemd</code> unit services, cronjobs and similar mechanisms are avoided.</p>
<p>At startup, <code>startx</code> will pass hardware-specific <code>xorg.conf</code> files to the X server, to enable hardware compositing on supported hardware and eliminate screen tearing.</p>
<p>Xorg‚Äôs security model forbids non-root users from passing arbitrary config files to the X server unless they are located in one of several ‚Äúblessed‚Äù directories.
Post-install scripts will create symlink <code>/etc/X11/$(id -u)-override</code> that points to <code>~/.config/xorg</code> to override this behavior.</p>
<h2>Optional X Window configuration<span id="Optional-X-Window-configuration"></span></h2>
<h3><code>~/.xrandr</code><span id=".xrandr"></span></h3>
<p>For use with multi-monitor and/or complicated display setups, you can override the default display layout with one or more commands to <code>xrandr</code> saved to <em>optional</em> config file <code>~/.xrandr</code></p>
<pre><code>&gt;&gt; e.g. two monitors, right is mounted vertically
--output HDMI-0 --auto --primary --rotate normal
--output HDMI-1 --auto --right-of HDMI-0 --rotate right
</code></pre>
<p>Commands in this file are passed to <a href="https://github.com/microsounds/atelier/blob/master/Scripts/xrandr_cycle.sh"><code>xrandr-cycle</code></a> line by line at startup if it exists.
For example, this configuration would suit a 2 monitor layout with the right monitor mounted vertically.</p>
<h3><code>~/.xdecor</code><span id=".xdecor"></span></h3>
<p>You can designate one or more paths to directories containing images or videos for use as a wallpaper using <em>optional</em> config file <code>~/.xdecor</code></p>
<pre><code>~/Pictures/some/path
/media/sd_card/some/path
</code></pre>
<p>If it exists, <a href="https://github.com/microsounds/atelier/blob/master/Scripts/xwin_decor.sh"><code>xwin-decor</code></a> will randomly pick a directory and file within it and set it as the wallpaper on startup.
In the case of video files, a random video frame from that file will be taken and set as the wallpaper using <code>ffmpeg</code>.</p>
<h2>X resources and theming<span id="X-resources-and-theming"></span></h2>
<p>For consistency, <code>xinit</code>, <code>dwm</code> and other scripts make use of the C preprocessor to mangle config files and configure color schemes.</p>
<p>Theme settings and individual color schemes are stored as C header files containing preprocessor macros representing color hex codes in <a href="https://github.com/microsounds/atelier/blob/master/.local/include"><code>~/.local/include</code></a>.
This directory is appended to <code>$C_INCLUDE_PATH</code> at login.</p>
<ul>
<li>Using shell function <code>reload</code> will reload changes to <code>.xresources</code> and hard-reset your current terminal instance.</li>
<li>Use command <code>palette</code> to soft-reset color scheme using OSC terminal escapes without losing the current shell.</li>
</ul>
<p><em>Optionally, you can apply another existing color scheme by naming it as an argument.
This can be useful when dealing with TUI applications that force their own background colors.</em></p>
<h3>List of available macros<span id="List-of-available-macros"></span></h3>
<ul>
<li><code>{FG,BG}COLOR</code> for terminal fg/bg colors</li>
<li><code>{FG,BG}LIGHT</code> for UX highlight colors</li>
<li><code>COLOR0..COLOR15</code> for the 16 standard ANSI terminal colors</li>
<li><code>FN_{TERM,HEADER,TEXT}</code> for specific font faces</li>
<li><code>FN_{TERM,HEADER}_JP</code> for matching fallback fonts</li>
<li><code>FN_{TERM,HEADER,TEXT}_SIZE</code> for matching font sizes</li>
</ul>
<h1>Non-standard commands<span id="Non-standard-commands"></span></h1>
<p>Several commands are extended to include impure functions, such as purposefully mangling config files, and have the following precedence when multiple versions exist:</p>
<ol>
<li>Interactive shell functions defined in <a href="https://github.com/microsounds/atelier/blob/master/.bashrc"><code>~/.bashrc</code></a></li>
<li>Non-interactive shell library executables in <a href="https://github.com/microsounds/atelier/blob/master/.local/lib"><code>~/.local/lib</code></a>
<ul>
<li>Shell script snippets used by multiple scripts to reduce clutter.</li>
</ul>
</li>
<li>Normal executables and symlinks in <a href="https://github.com/microsounds/atelier/blob/master/.local/bin"><code>~/.local/bin</code></a>
<ul>
<li>Some are shell functions promoted to scripts so they‚Äôll work in <code>dmenu</code> or outside of a terminal context.</li>
</ul>
</li>
<li><code>/usr/bin</code> system-wide executables</li>
</ol>
<h2><code>cd</code><span id="cd"></span></h2>
<ul>
<li>
<p>The contents of <code>$OLDPWD</code> is preserved between sessions.</p>
</li>
<li>
<p><code>cd</code> offers the following extensions:</p>
<table>
<thead>
<tr>
<th>opt</th>
<th>function</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>...</code>, <code>....</code>, etc.</td>
<td>Shorthand for <code>../../</code>, <code>../../../</code> and so on.</td>
</tr>
<tr>
<td><code>-e &lt;dirname&gt;</code></td>
<td>Fuzzy find and jump into a sub-directory.</td>
</tr>
</tbody>
</table>
</li>
</ul>
<h2><code>chromium</code><span id="chromium"></span></h2>
<blockquote>
<p><strong>NOTE</strong><br>
<em>On first-run, <code>chromium</code> will momentarily exit and restart to rebuild configuration and enable use of externally customized color options.</em></p>
</blockquote>
<p><code>chromium</code> was extended to mangle the user-hostile per-profile <code>Preferences</code> and global <code>Local State</code> JSON files with a series of chained <code>jq</code> filters stored in the following files, applying persistent settings in order.</p>
<ul>
<li><a href="https://github.com/microsounds/atelier/blob/master/.config/chromium/preferences.conf"><code>~/.config/chromium/preferences.conf</code></a></li>
<li><a href="https://github.com/microsounds/atelier/blob/master/.config/chromium/local_state.conf"><code>~/.config/chromium/local_state.conf</code></a></li>
</ul>
<p>C preprocessor syntax is also accepted, hex color values in the form <code>#RRGGBB</code> will be converted to a signed integer representing <code>0xBBGGRRAA</code> in two‚Äôs complement hexadecimal with <code>AA</code> (alpha channel) always set to <code>0xFF</code></p>
<h3>Managed policy overrides<span id="Managed-policy-overrides"></span></h3>
<p><code>chromium</code> is managed by <code>/etc/chromium/policies/managed/extensions.json</code>, set up during <a href="https://github.com/microsounds/atelier/blob/master/.once.d/29-chromium-extensions.sh">post-install</a>, which automatically installs several useful extensions on first-run, including <a href="https://ublockorigin.com">uBlock Origin</a>.</p>
<h2><code>git</code><span id="git"></span></h2>
<p><code>git</code> aliases are defined in <a href="https://github.com/microsounds/atelier/blob/master/.gitconfig"><code>~/.gitconfig</code></a> or implemented in interactive shell function <code>git()</code></p>
<p>See <em>Usage Notes</em> for more information.</p>
<ul>
<li>
<p><em>This is a critical component of the graphic shell environment, some aliases are cumulative in nature.</em></p>
<table>
<thead>
<tr>
<th>alias</th>
<th>function</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>meta</code></td>
<td>Appends <code>--git-dir=$HOME/.config/meta --work-tree=$HOME</code> to a <code>git</code> command.<br><em>(Added implicitly when outside a git directory.)</em></td>
</tr>
<tr>
<td><code>summary</code></td>
<td>Outlines the last 20 commits with a commit graph.</td>
</tr>
<tr>
<td><code>list-files</code></td>
<td>List all tracked filenames in repo, ideally for use with <code>xargs</code>.</td>
</tr>
<tr>
<td><code>flatten</code></td>
<td>Automatically melds <code>--fixup/squash</code> commits out of existence starting from the root commit.</td>
</tr>
<tr>
<td><code>checkin</code></td>
<td>Commit all changes immediately with a generic timestamp and hostname commit message.</td>
</tr>
<tr>
<td><code>shove</code></td>
<td>Runs <code>checkin</code> and pushes immediately.</td>
</tr>
<tr>
<td><code>sync</code></td>
<td>Runs <code>git meta pull</code> and then recurses through <code>~/Git</code> and runs <code>git pull</code> on every existing <code>git</code> repo found.</td>
</tr>
</tbody>
</table>
</li>
</ul>
<h2><code>nano</code><span id="nano"></span></h2>
<blockquote>
<p><strong>NOTE</strong><br>
<em><code>nano</code> keybind macros make use of inline non-printable control characters, you must use <code>nano</code> or <code>cat -v</code> to view <a href="https://github.com/microsounds/atelier/blob/master/.nanorc"><code>~/.nanorc</code></a> correctly.</em></p>
</blockquote>
<ul>
<li>
<p><code>nano</code> is an alias for <a href="https://github.com/microsounds/atelier/blob/master/Scripts/nano_overlay.sh"><code>nano-overlay</code></a> which mangles config files and offers the following extended options:</p>
<table>
<thead>
<tr>
<th>opt</th>
<th>function</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-e, --ctags &lt;tag&gt; &lt;#&gt;</code></td>
<td>Jumps into file containing <code>ctags</code> definition matching <code>&lt;tag&gt;</code>.<br>Optional <code>&lt;#&gt;</code> selects from multiple matches, <code>all</code> will open all of them.</td>
</tr>
<tr>
<td><code>-c, --ctags-dict &lt;file1&gt;...</code></td>
<td>Enable project-wide autocomplete by appending condensed dictionary of all <code>ctags</code> keywords to all files.<br>Dictionary will be removed upon exiting.</td>
</tr>
<tr>
<td><code>-f, --encrypt &lt;file&gt;</code></td>
<td>Open AES encrypted text file with a plaintext password. <br>File will be created if it doesn‚Äôt exist.</td>
</tr>
<tr>
<td><code>-j, --rsa &lt;file&gt;</code></td>
<td>Open AES encrypted text file with generic RSA keypair in PEM format. <br>File will be created if it doesn‚Äôt exist.</td>
</tr>
<tr>
<td><code>-s, --ssh-sign &lt;file&gt;</code></td>
<td>Open AES encrypted text file with a nonce value signed with SSH private key. <br>File will be created if it doesn‚Äôt exist.</td>
</tr>
<tr>
<td><code>-i, --identity &lt;key&gt;</code></td>
<td>Use an OpenSSL compatible keypair to encrypt/decrypt. <br>Can be a private key or a public key with private half stored in <code>ssh-agent</code></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Once inside the actual <code>nano</code>, the following keybind macros are available:</p>
<table>
<thead>
<tr>
<th>key</th>
<th>function</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>M-0</code></td>
<td>Execute current line as shell command and pipe contents of buffer as stdin.<br><em>Destructively replaces entire contents of buffer, useful for formatting.</em></td>
</tr>
<tr>
<td><code>M-1</code></td>
<td>Execute current line as shell command and paste output in current buffer.<br><em>Inline comments ok.</em></td>
</tr>
<tr>
<td><code>M-2</code></td>
<td>Select token underneath cursor and jump into it‚Äôs <code>ctags</code> definition(s) within the same shell.<br><em>Requires valid <code>tags</code> file in current or a parent directory.</em></td>
</tr>
<tr>
<td><code>M-4</code></td>
<td>Select token underneath cursor and jump into it‚Äôs <code>ctags</code> definition(s) in a new terminal window.<br><em>Requires valid <code>tags</code> file in current or a parent directory.</em></td>
</tr>
</tbody>
</table>
</li>
</ul>
<h2><code>notify-send</code><span id="notify-send"></span></h2>
<p>This particular <a href="https://github.com/microsounds/atelier/blob/master/.local/lib/notify-send"><code>notify-send</code></a> implements only <code>-t</code> for expiration time in seconds,
because it doesn‚Äôt tie into any <code>dbus</code>-based notification daemon implementing the <a href="https://www.galago-project.org/specs/notification/0.9/index.html">Desktop Notifications Specification</a>.</p>
<p>Instead, it‚Äôs just a shell script that writes to a named pipe that gets picked up by <a href="https://github.com/microsounds/atelier/blob/master/Scripts/wm_status.sh"><code>xwin-statusd</code></a> as a simple way to implement OSD text and single-line notifications.</p>
<p>Unlike other implementations, you can pass notifications/OSD text as an argument or via stdin without using <code>xargs</code>.</p>
<h2><code>sc</code> (spreadsheet calculator)<span id="sc-spreadsheet-calculator"></span></h2>
<p><code>sc</code> supports macros to some degree, but it‚Äôs macro documentation is largely non-existent or difficult to understand.</p>
<p>Instead, the shell function <code>sc()</code> offers an easier to understand macro system for mangling <code>.sc</code> spreadsheet files at runtime.</p>
<ul>
<li><code>sc</code> will automatically run any executable sharing the same initial name as the <code>.sc</code> file.
<ul>
<li><em>eg. <code>sheet1.sc</code> will run <code>sheet1.sc.1</code>, <code>sheet1.scx</code>, etc. if they exist in the same directory and are executable at runtime.</em></li>
</ul>
</li>
<li>You can write an arbitrarily complex pre-run macro script in any language, so long as it is made aware of it‚Äôs own filename at runtime.
<ul>
<li><em>Because the <code>sc</code> file format is plaintext, you can generate <code>sc</code> syntax with just a shell script.</em></li>
</ul>
</li>
</ul>
<h3><code>sc</code> pre-run macro example<span id="sc-pre-run-macro-example"></span></h3>
<ul>
<li>
<p>This is an example of a conditional macro script for an inventory spreadsheet that color-codes cells when specific strings are found.</p>
<pre><code class="language-shell">#!/usr/bin/env sh
# apply colors to specific strings in column B

file=&quot;${0%.*}&quot; # derive .sc file name from name of this script

# remove all instances of color from the file in place
{ rm &quot;$file&quot;; egrep -v '^color' &gt; &quot;$file&quot;; } &lt; &quot;$file&quot;

cat &lt;&lt;- EOF &gt;&gt; &quot;$file&quot; # set some non-default colors
    color 3 = @black;@red
    color 4 = @black;@yellow
    color 5 = @black;@green
EOF
# select only string cells from column B, apply colors based on string contents
# sc format: leftstring B2 = &quot;example string&quot;
egrep '^((left|right)string|label)' &lt; &quot;$file&quot; | while read -r cmd cell _ str; do
    case &quot;$cell&quot; in B*)
        case &quot;$str&quot; in
            *broken*) echo &quot;color $cell:$cell 3&quot;;;
            *bad*) echo &quot;color $cell:$cell 4&quot;;;
            *working*) echo &quot;color $cell:$cell 5&quot;;;
        esac;;
    esac
done &gt;&gt; &quot;$file&quot;
</code></pre>
</li>
</ul>
<h1>Complete source listing<span id="Complete-source-listing"></span></h1>
<pre><code><span class="term-prompt">root@30bb403ed33e</span>:<span class="term-dir">~</span>$ git meta ls-tree --name-only -r master | xargs ls -lhgG
total   rev. 0   <a href="https://raw.githubusercontent.com/microsounds/atelier/master/32K">32K</a>
drwxr-xr-x 2 4.0K    rev. 0   <a href="https://raw.githubusercontent.com/microsounds/atelier/master/Scripts">Scripts</a>
drwxr-xr-x 2 4.0K    rev. 0   <a href="https://raw.githubusercontent.com/microsounds/atelier/master/Userscripts">Userscripts</a>
-rw-r--r-- 1  19K    rev. 0   <a href="https://raw.githubusercontent.com/microsounds/atelier/master/readme&period;md">readme&period;md</a>
drwxr-xr-x 8 4.0K    rev. 0   <a href="https://raw.githubusercontent.com/microsounds/atelier/master/site">site</a>
</code></pre>
<!-- updated  -->
<hr>
<div class="footnote">
<p>
written materials <a href="https://creativecommons.org/licenses/by-sa/4.0">CC BY-SA 4.0</a>, source code <a href="https://www.gnu.org/licenses/gpl-3.0">GNU GPLv3+</a>
‚Äî &copy; 2015-2021 microsounds &lt;<a href="https://github.com/microsounds">https://github.com/microsounds</a>&gt;<br>
Powered by <a href="https://github.com/microsounds/kagami">kagami v0.5.3 ‚Äî static microblog processor</a>
</p>
</div>
</div>
</body>
</html>
